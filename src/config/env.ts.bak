import dotenv from 'dotenv';

dotenv.config();

interface EnvConfig {
  NODE_ENV: string;
  PORT: number;
  API_URL: string;
  
  // Database
  DB_TYPE: 'sqlite' | 'postgres';
  DB_FILE?: string; // For SQLite
  DB_HOST: string;
  DB_PORT: number;
  DB_USERNAME: string;
  DB_PASSWORD: string;
  DB_DATABASE: string;
  
  // JWT
  JWT_SECRET: string;
  JWT_EXPIRES_IN: string;
  
  // OpenAI
  OPENAI_API_KEY: string;
  OPENAI_MODEL: string;
  
  // Telegram
  TELEGRAM_BOT_TOKEN: string;
  TELEGRAM_WEBHOOK_URL?: string;
  
  // CORS
  CORS_ORIGIN: string[];
}

const getEnvConfig = (): EnvConfig => {
  return {
    NODE_ENV: process.env.NODE_ENV || 'development',
    PORT: parseInt(process.env.PORT || '3000'),
    API_URL: process.env.API_URL || 'http://localhost:3000',
    
    DB_TYPE: (process.env.DB_TYPE as 'sqlite' | 'postgres') || 'sqlite',
    DB_FILE: process.env.DB_FILE || 'telegram_fitness.db',
    DB_HOST: process.env.DB_HOST || 'localhost',
    DB_PORT: parseInt(process.env.DB_PORT || '5432'),
    DB_USERNAME: process.env.DB_USERNAME || 'postgres',
    DB_PASSWORD: process.env.DB_PASSWORD || '',
    DB_DATABASE: process.env.DB_DATABASE || 'telegram_fitness_db',
    
    JWT_SECRET: process.env.JWT_SECRET || 'change_this_secret',
    JWT_EXPIRES_IN: process.env.JWT_EXPIRES_IN || '7d',
    
    OPENAI_API_KEY: process.env.OPENAI_API_KEY || '',
    OPENAI_MODEL: process.env.OPENAI_MODEL || 'gpt-4',
    
    TELEGRAM_BOT_TOKEN: process.env.TELEGRAM_BOT_TOKEN || '',
    TELEGRAM_WEBHOOK_URL: process.env.TELEGRAM_WEBHOOK_URL,
    
    CORS_ORIGIN: process.env.CORS_ORIGIN?.split(',') || ['http://localhost:3000'],
    
    // Stripe
    STRIPE_SECRET_KEY: process.env.STRIPE_SECRET_KEY || '',
    STRIPE_PUBLISHABLE_KEY: process.env.STRIPE_PUBLISHABLE_KEY || '',
    STRIPE_WEBHOOK_SECRET: process.env.STRIPE_WEBHOOK_SECRET || '',
    FREE_WORKOUTS_PER_MONTH: parseInt(process.env.FREE_WORKOUTS_PER_MONTH || '3'),
    PREMIUM_PRICE_MONTHLY: parseFloat(process.env.PREMIUM_PRICE_MONTHLY || '9.99'),
    PREMIUM_CURRENCY: process.env.PREMIUM_CURRENCY || 'eur',
    FRONTEND_URL: process.env.FRONTEND_URL || 'http://localhost:5173',
  };
};

export const env = getEnvConfig();

// Validate required environment variables
export const validateEnv = (): void => {
  const required = ['TELEGRAM_BOT_TOKEN', 'OPENAI_API_KEY', 'JWT_SECRET', 'DB_PASSWORD'];
  const missing = required.filter(key => !process.env[key]);
  
  if (missing.length > 0) {
    console.warn(`⚠️  Missing environment variables: ${missing.join(', ')}`);
    console.warn('⚠️  Please check your .env file');
  }
};

